<html><head>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {'packages':['corechart', 'line']});
  google.charts.setOnLoadCallback(drawChart);

  // get the dataset with game info for our sidebars
  var dataset = {{ datedata }} ;

  function drawChart() {

    var data = new google.visualization.DataTable();
    data.addColumn('date', 'Date');
    data.addColumn('number', 'Game Count');
    data.addColumn({type: 'string', role: 'tooltip', p: {'html': true}});
    data.addRows( {{ datatable }} );

    var options = {
      vAxis: {
        title: 'Game Count',
        format: '#',
        gridlines: {count: -1},
      },
      hAxis: {
        title: 'Date',
        format: 'M/d/yy',
      },
      series: {
        1: {curveType: 'function'},
      },
      legend: {
        position: 'none',
      },
      tooltip: {
        trigger: 'both',
        isHtml: true,
      },
      explorer: {
        actions: ['dragToZoom', 'rightClickToReset'],
        axis: 'horizontal',
        maxZoomIn: 0.1,
        keepInBounds: true,
      },
      title: 'Unplayed Game Counts',
      width: 900,
      height: 500
    };

    var chart_div = document.getElementById('chart_div');
    var chart = new google.visualization.LineChart(chart_div);

    // define our static image function (calling getImageURI)
    function setStatic() {
      document.getElementById('png').innerHTML = '<img src="' + chart.getImageURI() + '">';
    };

    // wait for the chart to finish drawing before initializing our static image
    google.visualization.events.addListener(chart, 'ready', setStatic);

    // whenever our chart changes, redraw the static image
    var observer = new MutationObserver(setStatic);
    google.visualization.events.addListener(chart, 'ready', function() {
      observer.observe(chart_div, {
        childList: true,
        subtree: true,
      });
    });

    // show extra game information when we mouseover a specific day
    google.visualization.events.addListener(chart, 'onmouseover', function () {
      //toggleButton();
    });

    // show permanent game info when we click a specific day
    google.visualization.events.addListener(chart, 'select', function () {
      //toggleButton();
    });

    chart.draw(data, options);
  }
</script>

<script type="text/javascript">
  function toggleButton() {
    var button = document.getElementById('button');
    var div = document.getElementById('png');
    if (div.style.display !== 'none') {
      div.style.display = 'none';
      //button.innerHTML = 'Show Static Image';
    } else {
      div.style.display = 'block';
      //button.innerHTML = 'Hide Static Image';
    }
  };
</script>

<style>
  .google-tooltip {
    font-size: 15px;
    padding: 5px 5px 5px 5px;
    font-family: Arial, Helvetica;
  }
</style>

</head><body>

<div id="chart_div"></div>

Last Game Acquired on <b> {{ last_acquired }} </b>
(<span id="dayDiff"></span> ago)
<br><br>

<script>
    // count days since we last got a new game
    var last_acquired = {{ js_last_acquired }} ;
    var today = new Date();
    today.setHours(0,0,0,0);
    var diff = Math.abs(today - last_acquired);
    var days = Math.floor(diff / (1000 * 60 * 60 * 24));

    // "day" if 1 day, "days" otherwise
    var plural = "s";
    if (days == 1) {
      plural = "";
    }

    // write the answer to our html
    var div = document.getElementById("dayDiff");
    div.textContent = days + " day" + plural;
</script>

<button id='button' type='button' onclick='toggleButton()'>Toggle Static Image</button>

<div id='png' style="display:none"></div>

<br><br><br><img src="fine.png" />

<br><br>
<b><u>Unplayed Games ({{ unplayed_count }}):</u></b>
<br>
{{ unplayed_lines }}

</body></html>
